<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.5">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;TINA JOURNAL&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/vue@3/dist/vue.global.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/lucide@latest"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;family=Montserrat:wght@700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>:root {</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-bg: #F2EFE9;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-card: #FFFFFF;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-text: #333333;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-accent: #7F7161;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-red: #B3544B;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--muji-green: #6B7A5F;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Noto Sans TC', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--muji-bg);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--muji-text);</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-tap-highlight-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overscroll-behavior: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.muji-header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--muji-bg);</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 50;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.logo-font {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Montserrat', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>letter-spacing: 0.2em;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 極簡底線樣式 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.muji-input-underline {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 1px solid #EBE7E0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem 0.25rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: border-color 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.muji-input-underline:focus {</p>
<p class="p1"><span class="Apple-converted-space">            </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom-color: var(--muji-accent);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.muji-card {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--muji-card);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid rgba(230, 224, 217, 0.4);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.muji-btn-confirm {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--muji-accent);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 999px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>letter-spacing: 0.2em;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 提示視窗遮罩 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal-overlay {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(0, 0, 0, 0.4);</p>
<p class="p1"><span class="Apple-converted-space">            </span>backdrop-filter: blur(2px);</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 100;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 加大的月曆格子 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.calendar-cell {</p>
<p class="p1"><span class="Apple-converted-space">            </span>aspect-ratio: 1 / 1.5;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: flex-start;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-top: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.weekend-day { color: var(--muji-red) !important; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 分段按鈕樣式 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(230, 224, 217, 0.4);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 14px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-item {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 10px 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #A8A096;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-item.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--muji-accent);</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 8px rgba(0,0,0,0.06);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 類別標籤按鈕化 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.cat-btn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.5rem 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 999px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #EBE7E0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #A8A096;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.cat-btn.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: var(--muji-accent);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-color: var(--muji-accent);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>[v-cloak] { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>::-webkit-scrollbar { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="max-w-md mx-auto min-h-screen flex flex-col overflow-x-hidden"&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div id="app" v-cloak&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Header Banner --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;header class="muji-header sticky top-0 px-6 py-8 flex justify-between items-center border-b border-stone-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;span class="text-xl font-bold logo-font text-[#333]"&gt;TINA JOURNAL&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center space-x-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="text-right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-[9px] text-stone-300 leading-none mb-1 tracking-[0.2em] uppercase"&gt;Balance&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm font-bold text-stone-700"&gt;NT$ {{ formatNumber(annualTotal) }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="openSettings" class="text-stone-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i data-lucide="settings" class="w-6 h-6"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 錯誤訊息提示 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div v-if="errorMsg" class="fixed top-28 left-0 right-0 z-[60] px-6 animate-pulse"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-red-50 text-red-500 text-[11px] py-3 px-4 rounded-xl border border-red-100 shadow-xl flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;i data-lucide="alert-circle" class="w-4 h-4 mr-2"&gt;&lt;/i&gt; {{ errorMsg }}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 主要內容區 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;main class="flex-grow px-5 pt-6 pb-36"&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- 大項選擇器 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="segmented-control mb-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button v-for="cat in categories"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>@click="activeCategory = cat.id; errorMsg = ''; isEditing = false"</p>
<p class="p1"><span class="Apple-converted-space">                </span>:class="['segmented-item', activeCategory === cat.id ? 'active' : '']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{{ cat.name }}</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- 視圖：新增 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div v-if="activeTab === 'add'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="muji-card p-6 space-y-10 shadow-sm"&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- 1. 日常 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-if="activeCategory === 'daily'" class="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="segmented-control"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button @click="forms.daily.type = 'exp'; forms.daily.category = dailyCats.exp[0]" :class="['segmented-item', forms.daily.type === 'exp' ? 'active !text-[#6B7A5F]' : '']"&gt;支出&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button @click="forms.daily.type = 'inc'; forms.daily.category = dailyCats.inc[0]" :class="['segmented-item', forms.daily.type === 'inc' ? 'active !text-[#B3544B]' : '']"&gt;收入&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="grid grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Date&lt;/label&gt;&lt;input type="date" v-model="forms.daily.date" class="muji-input-underline"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase mb-2"&gt;Category&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="flex flex-wrap gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;button v-for="c in (forms.daily.type === 'exp' ? dailyCats.exp : dailyCats.inc)"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                            </span>@click="forms.daily.category = c"</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>:class="['cat-btn', forms.daily.category === c ? 'active' : '']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>{{ c }}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Amount&lt;/label&gt;&lt;input type="number" v-model="forms.daily.amount" class="muji-input-underline font-bold text-2xl" placeholder="0"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Note&lt;/label&gt;&lt;input type="text" v-model="forms.daily.note" class="muji-input-underline" placeholder="去哪啦"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="saveDaily" class="muji-btn-confirm"&gt;確認&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button v-if="isEditing" @click="cancelEdit" class="w-full text-[10px] text-stone-300 uppercase tracking-widest text-center"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- 2. 飲料 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-if="activeCategory === 'drinks'" class="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-2 gap-6 items-end"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Date&lt;/label&gt;&lt;input type="date" v-model="forms.drinks.date" class="muji-input-underline"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="pb-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="text-[10px] text-stone-300 font-bold block mb-3 uppercase"&gt;Rating ({{ forms.drinks.rating }})&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex space-x-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;template v-for="i in 5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div class="relative cursor-pointer w-6 h-6 flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;i data-lucide="star" :class="['w-6 h-6', forms.drinks.rating &gt;= i ? 'text-amber-400 fill-amber-400' : 'text-stone-100']"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;!-- 半星區域 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div class="absolute inset-y-0 left-0 w-1/2 h-full z-10" @click="setStarRating(i - 0.5)"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div class="absolute inset-y-0 right-0 w-1/2 h-full z-10" @click="setStarRating(i)"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/template&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-2 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Store&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input list="stores" v-model="forms.drinks.store" class="muji-input-underline" placeholder="店名"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;datalist id="stores"&gt;&lt;option v-for="s in history.stores" :value="s"&gt;&lt;/option&gt;&lt;/datalist&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Item&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input list="items" v-model="forms.drinks.item" class="muji-input-underline" placeholder="品項"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;datalist id="items"&gt;&lt;option v-for="it in history.items" :value="it"&gt;&lt;/option&gt;&lt;/datalist&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Sugar&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="segmented-control"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;button v-for="s in ['無糖', '少糖', '半糖', '正常']" @click="forms.drinks.sugar = s" :class="['segmented-item', forms.drinks.sugar === s ? 'active' : '']"&gt;{{ s }}&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Ice&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="segmented-control"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;button v-for="i in ['去冰', '少冰', '正常', '熱']" @click="forms.drinks.ice = i" :class="['segmented-item', forms.drinks.ice === i ? 'active' : '']"&gt;{{ i }}&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Amount&lt;/label&gt;&lt;input type="number" v-model="forms.drinks.amount" class="muji-input-underline font-bold text-lg" placeholder="0"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="saveDrink" class="muji-btn-confirm"&gt;確認&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button v-if="isEditing" @click="cancelEdit" class="w-full text-[10px] text-stone-300 uppercase text-center"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- 3. 麻將 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-if="activeCategory === 'mahjong'" class="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Date&lt;/label&gt;&lt;input type="date" v-model="forms.mahjong.date" class="muji-input-underline"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label class="text-[10px] text-stone-300 font-bold uppercase"&gt;Friends (Choose 3)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex flex-wrap gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button v-for="f in history.friends" @click="toggleFriend(f)" :class="['px-5 py-2.5 text-xs rounded-full border transition-all', forms.mahjong.friends.includes(f) ? 'bg-[#7F7161] text-white border-[#7F7161]' : 'bg-white text-stone-300 border-stone-100']"&gt;{{ f }}&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="segmented-control"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button @click="forms.mahjong.type = 'win'" :class="['segmented-item', forms.mahjong.type === 'win' ? 'active !text-[#B3544B]' : '']"&gt;贏錢&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button @click="forms.mahjong.type = 'loss'" :class="['segmented-item', forms.mahjong.type === 'loss' ? 'active !text-[#6B7A5F]' : '']"&gt;輸錢&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;&lt;label class="text-[10px] text-stone-300 font-bold uppercase text-center block"&gt;Total Result&lt;/label&gt;&lt;input type="number" v-model="forms.mahjong.amount" class="muji-input-underline text-3xl font-bold text-center" placeholder="0"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="saveMahjong" class="muji-btn-confirm"&gt;確認&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button v-if="isEditing" @click="cancelEdit" class="w-full text-[10px] text-stone-300 uppercase text-center"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- 視圖：月曆 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div v-if="activeTab === 'calendar'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="muji-card p-6 shadow-sm border-stone-100 flex flex-col space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex justify-between items-center px-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center space-x-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select v-model="calendarYear" class="text-base font-bold bg-stone-50 px-2 py-1 rounded-lg border-none outline-none appearance-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option v-for="y in availableYears" :value="y"&gt;{{ y }}&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="text-stone-200"&gt;/&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select v-model="calendarMonth" class="text-base font-bold bg-stone-50 px-2 py-1 rounded-lg border-none outline-none appearance-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option v-for="m in 12" :value="m-1"&gt;{{ String(m).padStart(2, '0') }}&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="goToday" class="w-10 h-10 rounded-full bg-stone-800 text-white text-[11px] flex items-center justify-center font-bold shadow-md active:scale-90 transition"&gt;今&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-7 gap-1 text-center text-[10px] font-bold text-stone-300 tracking-[0.2em] uppercase border-b pb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;Mon&lt;/div&gt;&lt;div&gt;Tue&lt;/div&gt;&lt;div&gt;Wed&lt;/div&gt;&lt;div&gt;Thu&lt;/div&gt;&lt;div&gt;Fri&lt;/div&gt;&lt;div class="weekend-day"&gt;Sat&lt;/div&gt;&lt;div class="weekend-day"&gt;Sun&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-7 gap-1.5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div v-for="day in calendarDays" :key="day.date"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>@click="selectDate(day)"</p>
<p class="p1"><span class="Apple-converted-space">                        </span>:class="['calendar-cell border transition-all',<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                 </span>day.isToday ? 'bg-stone-800 text-white shadow-lg z-10' : 'bg-stone-50/40 border-transparent',</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>selectedDate === day.date &amp;&amp; !day.isToday ? 'ring-2 ring-stone-200 bg-white shadow-sm' : '',</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>!day.currentMonth ? 'opacity-0 pointer-events-none' : '']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span class="font-bold" :class="{'weekend-day': (day.dayOfWeek===6 || day.dayOfWeek===0) &amp;&amp; !day.isToday}"&gt;{{ day.dayNum }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-if="day.catTotal !== 0" class="text-[10px] font-black mt-2 truncate w-full text-center px-0.5" :class="day.catTotal &gt; 0 ? (day.isToday ? 'text-red-300' : 'text-[#B3544B]') : (day.isToday ? 'text-green-200' : 'text-[#6B7A5F]')"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ day.catTotal &gt; 0 ? '+' : '' }}{{ day.catTotal }}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- 明細 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="selectedDateRecords.length" class="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="px-3 text-[10px] text-stone-300 font-bold tracking-widest uppercase"&gt;{{ selectedDate }} ARCHIVE&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div v-for="rec in selectedDateRecords" :key="rec.id" class="muji-card p-5 flex justify-between items-center group active:bg-stone-50 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center space-x-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="w-11 h-11 rounded-full bg-stone-50 flex items-center justify-center text-stone-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;i :data-lucide="getIcon(rec.mode)" class="w-5 h-5"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm font-bold text-stone-700"&gt;{{ rec.category }} {{ rec.item || '' }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-[11px] text-stone-400 font-medium"&gt;{{ rec.note || '去哪啦' }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p :class="['text-base font-bold', isPositive(rec) ? 'text-[#B3544B]' : 'text-[#6B7A5F]']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{{ isPositive(rec) ? '+' : '-' }}{{ formatNumber(rec.amount) }}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex space-x-4 mt-1 opacity-0 group-hover:opacity-100 transition-opacity justify-end"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button @click="copyRecord(rec)" class="text-[10px] text-stone-300 font-bold uppercase"&gt;Copy&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button @click="editRecord(rec)" class="text-[10px] text-stone-400 font-bold uppercase"&gt;Edit&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button @click="deleteRecord(rec.id)" class="text-[10px] text-red-200 font-bold uppercase"&gt;Del&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- 視圖：數據分析 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div v-if="activeTab === 'data'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-center text-[11px] text-stone-300 font-bold tracking-[0.5em] uppercase"&gt;{{ currentCategoryName }} ANALYSIS&lt;/h2&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="activeCategory === 'daily'" class="space-y-5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="muji-card p-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xs font-bold mb-8 text-stone-600"&gt;Category Spending&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-for="(val, cat) in dailyStatsByCategory" :key="cat"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="flex justify-between text-[11px] mb-2 font-bold uppercase tracking-wider"&gt;&lt;span&gt;{{ cat }}&lt;/span&gt;&lt;span&gt;${{ formatNumber(val) }}&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="w-full bg-stone-50 h-1 rounded-full overflow-hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div class="bg-stone-400 h-1 rounded-full transition-all duration-1000" :style="{width: (val/stats.daily.totalExp * 100) + '%'}"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="activeCategory === 'drinks'" class="space-y-5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="muji-card p-6 text-center"&gt;&lt;p class="text-[9px] text-stone-300 mb-2 uppercase font-bold tracking-widest"&gt;TOP STORE&lt;/p&gt;&lt;p class="text-sm font-bold text-stone-700 truncate px-2"&gt;{{ favoriteDrink.store || '-' }}&lt;/p&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="muji-card p-6 text-center"&gt;&lt;p class="text-[9px] text-stone-300 mb-2 uppercase font-bold tracking-widest"&gt;FAVORITE&lt;/p&gt;&lt;p class="text-sm font-bold text-stone-700 truncate px-2"&gt;{{ favoriteDrink.item || '-' }}&lt;/p&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="muji-card p-14 text-center bg-stone-800 text-white border-none shadow-xl"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="text-[10px] opacity-30 mb-4 uppercase tracking-[0.4em] font-bold"&gt;Annual Cups&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="text-9xl font-light leading-none logo-font"&gt;{{ stats.drinks.totalCups }}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="w-10 h-0.5 bg-white/20 mx-auto mt-10"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="activeCategory === 'mahjong'" class="space-y-5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="muji-card p-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xs font-bold mb-6 text-stone-600"&gt;Battle Stats&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="divide-y divide-stone-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div v-for="f in history.friends" :key="f" class="py-5 flex justify-between items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;span class="text-sm text-stone-600 font-bold uppercase tracking-wider"&gt;{{ f }}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="text-right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="text-base font-bold text-[#B3544B]"&gt;{{ getFriendWinRate(f) }}%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;p class="text-[9px] text-stone-300 font-bold tracking-tighter uppercase"&gt;Win Rate&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="exportToExcel" class="w-full py-5 bg-white border border-stone-200 text-stone-300 text-[11px] rounded-full tracking-widest uppercase font-bold shadow-sm active:bg-stone-50 transition-colors"&gt;Export Spreadsheet&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 成功提示 (灰色遮罩) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div v-if="showSuccess" class="fixed inset-0 modal-overlay flex items-center justify-center p-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-[3rem] p-12 text-center shadow-2xl scale-in transform w-full max-w-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="w-16 h-16 bg-stone-800 text-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i data-lucide="check" class="w-8 h-8"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="font-bold tracking-[0.3em] text-stone-800 text-lg uppercase"&gt;新增成功！&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-[10px] text-stone-300 mt-4 font-bold uppercase tracking-tighter"&gt;Secured in Ledger&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 設定抽屜 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div v-if="showSettings" class="fixed inset-0 modal-overlay flex items-end" @click.self="showSettings = false"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white w-full rounded-t-[3.5rem] p-10 pb-16 space-y-8 shadow-2xl max-h-[90vh] overflow-y-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="w-12 h-1 bg-stone-100 rounded-full mx-auto -mt-4 mb-6"&gt;&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="settingsView === 'main'" class="space-y-5"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 class="text-center font-bold text-stone-700 tracking-widest text-sm uppercase mb-6"&gt;Archive Settings&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-1 gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="settingsView = 'years'" class="flex justify-between items-center p-6 bg-stone-50/50 rounded-2xl active:bg-stone-100 transition"&gt;&lt;span class="text-sm font-bold text-stone-600 uppercase tracking-widest"&gt;歷史帳本切換&lt;/span&gt;&lt;i data-lucide="chevron-right" class="w-5 h-5 text-stone-200"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="settingsView = 'cats'" class="flex justify-between items-center p-6 bg-stone-50/50 rounded-2xl active:bg-stone-100 transition"&gt;&lt;span class="text-sm font-bold text-stone-600 uppercase tracking-widest"&gt;日常類別管理&lt;/span&gt;&lt;i data-lucide="chevron-right" class="w-5 h-5 text-stone-200"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="settingsView = 'friends'" class="flex justify-between items-center p-6 bg-stone-50/50 rounded-2xl active:bg-stone-100 transition"&gt;&lt;span class="text-sm font-bold text-stone-600 uppercase tracking-widest"&gt;麻友名單管理&lt;/span&gt;&lt;i data-lucide="chevron-right" class="w-5 h-5 text-stone-200"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="pt-12 border-t border-stone-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="clearAllData" class="w-full py-5 text-[11px] text-red-300 tracking-widest uppercase font-bold"&gt;Wipe Data&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="settingsView === 'years'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button @click="settingsView = 'main'" class="flex items-center text-[11px] font-bold text-stone-300 uppercase tracking-widest mb-4"&gt;&lt;i data-lucide="chevron-left" class="w-4 h-4 mr-2"&gt;&lt;/i&gt; Back&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-3 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button v-for="y in availableYears" @click="currentYear = y; showSettings = false" :class="['py-4 text-xs font-bold rounded-2xl border transition', currentYear === y ? 'bg-stone-800 text-white border-stone-800 shadow-md' : 'bg-white text-stone-300 border-stone-100']"&gt;{{ y }}&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="settingsView === 'cats'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button @click="settingsView = 'main'" class="flex items-center text-[11px] font-bold text-stone-300 uppercase tracking-widest mb-4"&gt;&lt;i data-lucide="chevron-left" class="w-4 h-4 mr-2"&gt;&lt;/i&gt; Back&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-wrap gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span v-for="c in dailyCats.exp" class="flex items-center px-5 py-3 bg-stone-50 text-[11px] font-bold text-stone-500 rounded-full border border-stone-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{{ c }} &lt;button @click="removeDailyCat(c)" class="ml-3 text-stone-200"&gt;×&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="addDailyCatPrompt" class="px-5 py-3 border border-dashed border-stone-200 text-stone-200 text-[11px] font-bold rounded-full"&gt;＋ New Category&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div v-if="settingsView === 'friends'" class="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button @click="settingsView = 'main'" class="flex items-center text-[11px] font-bold text-stone-300 uppercase tracking-widest mb-4"&gt;&lt;i data-lucide="chevron-left" class="w-4 h-4 mr-2"&gt;&lt;/i&gt; Back&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-wrap gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span v-for="f in history.friends" class="flex items-center px-5 py-3 bg-stone-50 text-[11px] font-bold text-stone-500 rounded-full border border-stone-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>{{ f }} &lt;button @click="removeFriend(f)" class="ml-3 text-stone-200"&gt;×&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button @click="addFriendPrompt" class="px-5 py-3 border border-dashed border-stone-200 text-stone-200 text-[11px] font-bold rounded-full"&gt;＋ Add Friend&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button @click="showSettings = false" class="w-full py-5 bg-stone-50 rounded-3xl text-[11px] font-bold text-stone-400 uppercase tracking-widest"&gt;Close Menu&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- 底部導覽列 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-stone-100 px-20 py-8 flex justify-between items-center max-w-md mx-auto z-40 rounded-t-[4rem] shadow-2xl"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button @click="activeTab = 'calendar'; errorMsg = ''" :class="['flex flex-col items-center transition', activeTab === 'calendar' ? 'text-stone-800' : 'text-stone-200']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;i data-lucide="calendar" class="w-6 h-6"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button @click="prepareAdd" class="w-16 h-16 bg-stone-800 rounded-full shadow-2xl flex items-center justify-center text-white -mt-20 border-[8px] border-[#F2EFE9] active:scale-90 transition"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;i data-lucide="plus" class="w-8 h-8"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button @click="activeTab = 'data'; errorMsg = ''" :class="['flex flex-col items-center transition', activeTab === 'data' ? 'text-stone-800' : 'text-stone-200']"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;i data-lucide="pie-chart" class="w-6 h-6"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/nav&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">const { createApp, ref, onMounted, computed, watch } = Vue;</p>
<p class="p2"><br></p>
<p class="p1">createApp({</p>
<p class="p1"><span class="Apple-converted-space">    </span>setup() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const activeTab = ref('add');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const activeCategory = ref('daily');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const showSuccess = ref(false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const showSettings = ref(false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const settingsView = ref('main');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const isEditing = ref(false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const editingId = ref(null);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const currentYear = ref(new Date().getFullYear());</p>
<p class="p1"><span class="Apple-converted-space">        </span>const errorMsg = ref('');</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const getTodayStr = () =&gt; new Date().toISOString().split('T')[0];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 資料持久化 (localStorage)</p>
<p class="p1"><span class="Apple-converted-space">        </span>const records = ref(JSON.parse(localStorage.getItem('tina_journal_db') || '[]'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>const history = ref(JSON.parse(localStorage.getItem('tina_hist_db') || '{"stores":[], "items":[], "friends":["自己", "朋友A", "朋友B"]}'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyCats = ref(JSON.parse(localStorage.getItem('tina_cats_db') || JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">            </span>exp: ['餐飲', '交通', '購物', '娛樂', '醫療', '社交'],</p>
<p class="p1"><span class="Apple-converted-space">            </span>inc: ['薪水', '獎金', '投資']</p>
<p class="p1"><span class="Apple-converted-space">        </span>})));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const forms = ref({</p>
<p class="p1"><span class="Apple-converted-space">            </span>daily: { date: getTodayStr(), type: 'exp', category: '餐飲', amount: '', note: '' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>drinks: { date: getTodayStr(), rating: 0, store: '', item: '', sugar: '無糖', ice: '去冰', amount: '' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>mahjong: { date: getTodayStr(), friends: [], type: 'win', amount: '' }</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const categories = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>{ id: 'daily', name: '日常' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>{ id: 'drinks', name: '飲料' },</p>
<p class="p1"><span class="Apple-converted-space">            </span>{ id: 'mahjong', name: '麻將' }</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const calendarYear = ref(new Date().getFullYear());</p>
<p class="p1"><span class="Apple-converted-space">        </span>const calendarMonth = ref(new Date().getMonth());</p>
<p class="p1"><span class="Apple-converted-space">        </span>const selectedDate = ref(getTodayStr());</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatNumber = (num) =&gt; Number(num || 0).toLocaleString();</p>
<p class="p1"><span class="Apple-converted-space">        </span>const currentCategoryName = computed(() =&gt; categories.find(c =&gt; c.id === activeCategory.value).name);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const isPositive = (rec) =&gt; ['inc', 'win'].includes(rec.type);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const availableYears = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const years = new Set(records.value.map(r =&gt; new Date(r.date).getFullYear()));</p>
<p class="p1"><span class="Apple-converted-space">            </span>years.add(new Date().getFullYear());</p>
<p class="p1"><span class="Apple-converted-space">            </span>return Array.from(years).sort((a,b) =&gt; b-a);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 評分星星</p>
<p class="p1"><span class="Apple-converted-space">        </span>const setStarRating = (r) =&gt; { forms.value.drinks.rating = r; setTimeout(() =&gt; lucide.createIcons(), 0); };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 檢核與儲存</p>
<p class="p1"><span class="Apple-converted-space">        </span>const validate = (data) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>errorMsg.value = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!data.amount || Number(data.amount) &lt;= 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>errorMsg.value = '金額必須填寫大於 0 哦！';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (activeCategory.value === 'daily' &amp;&amp; !data.category) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>errorMsg.value = '類別是必填項哦！';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (activeCategory.value === 'drinks' &amp;&amp; (!data.store || !data.item)) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>errorMsg.value = '店名與飲品都要填寫！';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (activeCategory.value === 'mahjong' &amp;&amp; data.friends.length !== 3) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>errorMsg.value = '麻將需要剛好選擇 3 位朋友！';</p>
<p class="p1"><span class="Apple-converted-space">                </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>return true;</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const commit = (data) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isEditing.value) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>records.value = records.value.map(r =&gt; r.id === editingId.value ? { ...data, id: editingId.value } : r);</p>
<p class="p1"><span class="Apple-converted-space">                </span>isEditing.value = false; editingId.value = null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>records.value.push({ ...data, id: Date.now() });</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>showSuccess.value = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; { showSuccess.value = false; }, 1500);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveDaily = () =&gt; { if(validate(forms.value.daily)) { commit({...forms.value.daily, mode: 'daily'}); forms.value.daily.amount = ''; forms.value.daily.note = ''; } };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveDrink = () =&gt; { if(validate(forms.value.drinks)) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>commit({...forms.value.drinks, mode: 'drinks', category: '飲料'});</p>
<p class="p1"><span class="Apple-converted-space">            </span>if(!history.value.stores.includes(forms.value.drinks.store)) history.value.stores.push(forms.value.drinks.store);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if(!history.value.items.includes(forms.value.drinks.item)) history.value.items.push(forms.value.drinks.item);</p>
<p class="p1"><span class="Apple-converted-space">            </span>forms.value.drinks.amount = ''; forms.value.drinks.rating = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}};</p>
<p class="p1"><span class="Apple-converted-space">        </span>const saveMahjong = () =&gt; { if(validate(forms.value.mahjong)) { commit({...forms.value.mahjong, mode: 'mahjong', category: '麻將'}); forms.value.mahjong.amount = ''; } };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 控制功能</p>
<p class="p1"><span class="Apple-converted-space">        </span>const deleteRecord = (id) =&gt; { if(confirm("確定刪除這筆紀錄？")) records.value = records.value.filter(r =&gt; r.id !== id); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const copyRecord = (rec) =&gt; { activeTab.value = 'add'; activeCategory.value = rec.mode; const {id, ...rest} = rec; forms.value[rec.mode] = JSON.parse(JSON.stringify(rest)); isEditing.value = false; };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const editRecord = (rec) =&gt; { activeTab.value = 'add'; activeCategory.value = rec.mode; forms.value[rec.mode] = JSON.parse(JSON.stringify(rec)); isEditing.value = true; editingId.value = rec.id; };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const cancelEdit = () =&gt; { isEditing.value = false; editingId.value = null; resetForms(); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const prepareAdd = () =&gt; { activeTab.value = 'add'; isEditing.value = false; resetForms(); errorMsg.value = ''; };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const resetForms = () =&gt; { const t = getTodayStr(); forms.value.daily.date = t; forms.value.drinks.date = t; forms.value.mahjong.date = t; };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const goToday = () =&gt; { const now = new Date(); calendarYear.value = now.getFullYear(); calendarMonth.value = now.getMonth(); selectedDate.value = getTodayStr(); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const openSettings = () =&gt; { showSettings.value = true; settingsView.value = 'main'; };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 統計邏輯</p>
<p class="p1"><span class="Apple-converted-space">        </span>const annualTotal = computed(() =&gt; records.value.filter(r =&gt; new Date(r.date).getFullYear() === currentYear.value).reduce((s, r) =&gt; s + (isPositive(r) ? Number(r.amount) : -Number(r.amount)), 0));</p>
<p class="p1"><span class="Apple-converted-space">        </span>const stats = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const cur = records.value.filter(r =&gt; new Date(r.date).getFullYear() === calendarYear.value &amp;&amp; new Date(r.date).getMonth() === calendarMonth.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return {</p>
<p class="p1"><span class="Apple-converted-space">                </span>daily: { totalExp: cur.filter(r =&gt; r.mode === 'daily' &amp;&amp; r.type === 'exp').reduce((s, r) =&gt; s + Number(r.amount), 0) },</p>
<p class="p1"><span class="Apple-converted-space">                </span>drinks: { totalCups: records.value.filter(r =&gt; r.mode === 'drinks' &amp;&amp; new Date(r.date).getFullYear() === calendarYear.value).length }</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dailyStatsByCategory = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const res = {};</p>
<p class="p1"><span class="Apple-converted-space">            </span>records.value.filter(r =&gt; r.mode === 'daily' &amp;&amp; r.type === 'exp' &amp;&amp; new Date(r.date).getFullYear() === calendarYear.value &amp;&amp; new Date(r.date).getMonth() === calendarMonth.value).forEach(r =&gt; res[r.category] = (res[r.category] || 0) + Number(r.amount));</p>
<p class="p1"><span class="Apple-converted-space">            </span>return res;</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>const favoriteDrink = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const d = records.value.filter(r =&gt; r.mode === 'drinks' &amp;&amp; new Date(r.date).getFullYear() === calendarYear.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!d.length) return {};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const count = (arr, k) =&gt; arr.reduce((a, r) =&gt; (a[r[k]] = (a[r[k]] || 0) + 1, a), {});</p>
<p class="p1"><span class="Apple-converted-space">            </span>const fav = (obj) =&gt; Object.keys(obj).length ? Object.keys(obj).reduce((a,b) =&gt; obj[a] &gt; obj[b] ? a : b) : '-';</p>
<p class="p1"><span class="Apple-converted-space">            </span>return { store: fav(count(d, 'store')), item: fav(count(d, 'item')) };</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 月曆生成</p>
<p class="p1"><span class="Apple-converted-space">        </span>const calendarDays = computed(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const first = new Date(calendarYear.value, calendarMonth.value, 1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const last = new Date(calendarYear.value, calendarMonth.value + 1, 0);</p>
<p class="p1"><span class="Apple-converted-space">            </span>let days = [];</p>
<p class="p1"><span class="Apple-converted-space">            </span>let start = first.getDay() || 7;</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (let i = 1; i &lt; start; i++) days.push({ currentMonth: false });</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (let i = 1; i &lt;= last.getDate(); i++) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dStr = `${calendarYear.value}-${String(calendarMonth.value + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dayRecs = records.value.filter(r =&gt; r.date === dStr &amp;&amp; r.mode === activeCategory.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const tot = dayRecs.reduce((a, r) =&gt; a + (isPositive(r) ? Number(r.amount) : -Number(r.amount)), 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>days.push({ dayNum: i, currentMonth: true, date: dStr, catTotal: tot, isToday: dStr === getTodayStr(), dayOfWeek: new Date(dStr).getDay() });</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>return days;</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>const selectedDateRecords = computed(() =&gt; records.value.filter(r =&gt; r.date === selectedDate.value &amp;&amp; r.mode === activeCategory.value));</p>
<p class="p1"><span class="Apple-converted-space">        </span>const selectDate = (d) =&gt; { if (d.date) selectedDate.value = d.date; setTimeout(() =&gt; lucide.createIcons(), 0); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const getIcon = (m) =&gt; m === 'drinks' ? 'cup-soda' : (m === 'mahjong' ? 'clover' : 'edit-3');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const getFriendWinRate = (f) =&gt; { const g = records.value.filter(r =&gt; r.mode === 'mahjong' &amp;&amp; r.friends.includes(f)); return g.length ? Math.round((g.filter(r =&gt; r.type === 'win').length / g.length) * 100) : 0; };</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 設定工具</p>
<p class="p1"><span class="Apple-converted-space">        </span>const toggleFriend = (f) =&gt; { const i = forms.value.mahjong.friends.indexOf(f); i &gt; -1 ? forms.value.mahjong.friends.splice(i, 1) : (forms.value.mahjong.friends.length &lt; 3 &amp;&amp; forms.value.mahjong.friends.push(f)); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const addFriendPrompt = () =&gt; { const n = prompt("輸入麻友姓名："); if(n) history.value.friends.push(n); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const removeFriend = (f) =&gt; history.value.friends = history.value.friends.filter(i =&gt; i !== f);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const addDailyCatPrompt = () =&gt; { const n = prompt("輸入新分類名稱："); if(n) dailyCats.value.exp.push(n); };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const removeDailyCat = (c) =&gt; dailyCats.value.exp = dailyCats.value.exp.filter(i =&gt; i !== c);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const exportToExcel = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const ws = XLSX.utils.json_to_sheet(records.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const wb = XLSX.utils.book_new();</p>
<p class="p1"><span class="Apple-converted-space">            </span>XLSX.utils.book_append_sheet(wb, ws, "TINA_JOURNAL");</p>
<p class="p1"><span class="Apple-converted-space">            </span>XLSX.writeFile(wb, `TINA_JOURNAL_${calendarYear.value}.xlsx`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const clearAllData = () =&gt; { if (confirm("確定抹除？")) { localStorage.clear(); location.reload(); } };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>watch([records, history, dailyCats, activeTab], () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>localStorage.setItem('tina_journal_db', JSON.stringify(records.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>localStorage.setItem('tina_hist_db', JSON.stringify(history.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>localStorage.setItem('tina_cats_db', JSON.stringify(dailyCats.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; lucide.createIcons(), 0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}, { deep: true });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>onMounted(() =&gt; lucide.createIcons());</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>return {</p>
<p class="p1"><span class="Apple-converted-space">            </span>activeTab, activeCategory, categories, showSuccess, showSettings, settingsView, isEditing, currentYear,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>calendarYear, calendarMonth, availableYears, currentCategoryName, errorMsg,</p>
<p class="p1"><span class="Apple-converted-space">            </span>records, history, dailyCats, forms, stats, annualTotal, dailyStatsByCategory, favoriteDrink,</p>
<p class="p1"><span class="Apple-converted-space">            </span>calendarDays, selectedDate, selectedDateRecords,</p>
<p class="p1"><span class="Apple-converted-space">            </span>formatNumber, isPositive, getIcon, saveDaily, saveDrink, saveMahjong, deleteRecord, copyRecord, editRecord, cancelEdit,</p>
<p class="p1"><span class="Apple-converted-space">            </span>prepareAdd, goToday, selectDate, toggleFriend, addFriendPrompt, removeFriend, addDailyCatPrompt, removeDailyCat,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>exportToExcel, clearAllData, openSettings, getFriendWinRate, setStarRating</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">}).mount('#app');</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
